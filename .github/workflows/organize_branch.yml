name: Organize Branch

on:
  pull_request:
    types: [closed] # PRì´ 'closed' ìƒíƒœì¼ ë•Œ ì‹¤í–‰
    branches:
      - 'release/*' # release ë¸Œëœì¹˜ì— pushê°€ ë°œìƒí•˜ë©´ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
permissions:
  contents: write # ë¦¬í¬ì§€í† ë¦¬ ë‚´ìš© ìˆ˜ì • ê¶Œí•œ
  id-token: write # GitHub ID í† í°ì„ ì“¸ ìˆ˜ ìˆëŠ” ê¶Œí•œ

jobs:
  build:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    steps:
      - name: âœ… ì²´í¬ì•„ì›ƒ source code.
        uses: actions/checkout@v3

      - name: ì‘ì—… ì •ë¦¬ ëŒ€ìƒ ë¸ŒëŸ°ì¹˜
        run: echo "ì‘ì—… ì •ë¦¬ ëŒ€ìƒ ë¸ŒëŸ°ì¹˜ëŠ” ${{ github.ref }} ì…ë‹ˆë‹¤."

      - name: ğŸš€ develop ë¸Œëœì¹˜ ì •ë¦¬ì‹œì‘
        run: |
          git checkout develop
          git pull origin develop
          
          echo "develop ë¸Œëœì¹˜ë¡œ ì²´í¬ì•„ì›ƒ ì™„ë£Œ"

          git merge ${{ github.ref }}
          git push origin develop
          echo "develop ë¸Œëœì¹˜ë¡œ merge ì™„ë£Œ"

          git push origin --delete ${{ github.ref }}
          echo "release ë¸Œëœì¹˜ ì‚­ì œ ì™„ë£Œ"
      